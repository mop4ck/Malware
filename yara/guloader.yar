rule guloader_type1
{
    meta:
    author        = "FSICEAT_MHPARK"
    type          = "TROJAN"
    version       = "0.3"
    date          = "2020-03-18"
    update	  = "2020-03-26"
    description   = "Detects guloader"
      
    strings:
    $vb_sig = {56 42 35 21 36 26 2a 00 00 00 00 00}
    $msvbvm60 = "MSVBVM60.DLL"
    $mstsc = "mstsc.exe"
    $loop_jump = {(8B 1? | 8B 04 ?? | FF 37) [4-60] 31 F? [4-40] (89 0C | 89 1C | 89 2C | 89 3C | 8F 04) [25-80] 81 F? ?? ?? 00 00 (75 ?? | 0F 85 ?? FF FF FF) [4-40] FF ??}
    // 8B 1? mov reg OR 8B 04 ?? mov reg, dword ptr
    // 31 F? xor reg
    // 89 1C ?? mov dword ptr ds:[reg + reg]  OR  8F 04 ?? pop dword ptr ds:[reg + reg]
    // 81 F? ?? ?? 00 00 cmp reg with size
    // 75 jne
    // FF ?? call or jmp

    condition:
    new_file and $vb_sig and ($msvbvm60 or $mstsc) and $loop_jump and not signatures contains "PonyStealer"

}
